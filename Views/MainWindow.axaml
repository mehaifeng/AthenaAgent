<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Athena.UI.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="using:Athena.UI.Models"
        xmlns:views="using:Athena.UI.Views"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
        x:Class="Athena.UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Athena AI Assistant"
        Width="900" Height="700"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterScreen"
        Icon="/Assets/avalonia-logo.ico">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <!-- 加载动画样式 - 使用透明度动画 -->
        <Style Selector="Panel.loading-panel > TextBlock">
            <Setter Property="Opacity" Value="0"/>
        </Style>
        <Style Selector="Panel.loading-panel > TextBlock:nth-child(1)">
            <Style.Animations>
                <Animation Duration="0:0:1.8" IterationCount="Infinite">
                    <KeyFrame Cue="0%"> <Setter Property="Opacity" Value="1"/> </KeyFrame>
                    <KeyFrame Cue="16%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="100%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Panel.loading-panel > TextBlock:nth-child(2)">
            <Style.Animations>
                <Animation Duration="0:0:1.8" IterationCount="Infinite">
                    <KeyFrame Cue="0%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="16%"> <Setter Property="Opacity" Value="1"/> </KeyFrame>
                    <KeyFrame Cue="33%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="100%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Panel.loading-panel > TextBlock:nth-child(3)">
            <Style.Animations>
                <Animation Duration="0:0:1.8" IterationCount="Infinite">
                    <KeyFrame Cue="0%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="33%"> <Setter Property="Opacity" Value="1"/> </KeyFrame>
                    <KeyFrame Cue="50%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="100%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Panel.loading-panel > TextBlock:nth-child(4)">
            <Style.Animations>
                <Animation Duration="0:0:1.8" IterationCount="Infinite">
                    <KeyFrame Cue="0%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="50%"> <Setter Property="Opacity" Value="1"/> </KeyFrame>
                    <KeyFrame Cue="66%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="100%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Panel.loading-panel > TextBlock:nth-child(5)">
            <Style.Animations>
                <Animation Duration="0:0:1.8" IterationCount="Infinite">
                    <KeyFrame Cue="0%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="66%"> <Setter Property="Opacity" Value="1"/> </KeyFrame>
                    <KeyFrame Cue="83%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="100%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Panel.loading-panel > TextBlock:nth-child(6)">
            <Style.Animations>
                <Animation Duration="0:0:1.8" IterationCount="Infinite">
                    <KeyFrame Cue="0%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                    <KeyFrame Cue="83%"> <Setter Property="Opacity" Value="1"/> </KeyFrame>
                    <KeyFrame Cue="100%"> <Setter Property="Opacity" Value="0"/> </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="*,Auto">
        <!-- TabControl -->
        <TabControl Grid.Row="0"
                   SelectedIndex="{Binding SelectedTabIndex, UpdateSourceTrigger=PropertyChanged}"
                   Margin="0"
                   Name="MainTabControl">

            <!-- CHAT Tab (index 0) -->
            <TabItem Header="CHAT">
                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- 顶部栏 -->
                    <Border Grid.Row="0"
                            BorderBrush="{DynamicResource DosBorderBrush}"
                            BorderThickness="0,0,0,2"
                            Padding="8,4"
                            Background="{DynamicResource DosBackgroundBrush}">
                        <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                            <!-- 标题 -->
                            <TextBlock Grid.Column="0"
                                       Text="ATHENA AI ASSISTANT"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       FontSize="14"
                                       FontWeight="Bold"/>

                            <!-- 主题切换按钮 -->
                            <Button Grid.Column="1"
                                    Content="{Binding CurrentTheme}"
                                    Command="{Binding ToggleThemeCommand}"
                                    FontSize="12"
                                    Padding="8,4"
                                    Margin="8,0"/>

                            <!-- 新对话按钮 -->
                            <Button Grid.Column="2"
                                    Content="[NEW]"
                                    Command="{Binding NewConversationCommand}"
                                    FontSize="12"
                                    Padding="8,4"
                                    Margin="0,0,8,0"
                                    ToolTip.Tip="新对话"/>

                            <!-- 心跳按钮 -->
                            <Button Grid.Column="3"
                                    Content="[*]"
                                    FontSize="14"
                                    IsVisible="{Binding ShowHeartbeatButton}"
                                    Command="{Binding SwitchToTasksTabCommand}"
                                    ToolTip.Tip="计划任务"
                                    Padding="8,4"/>
                        </Grid>
                    </Border>

                    <!-- 对话区域 -->
                    <ScrollViewer Grid.Row="1"
                                  Name="ChatScrollViewer"
                                  Background="{DynamicResource DosBackgroundBrush}"
                                  Padding="16,10">
                        <ItemsControl ItemsSource="{Binding Messages}" x:Name="MessagesItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="models:ChatMessage">
                                    <!-- 根据是否为用户消息决定对齐方式 -->
                                    <Grid Margin="0,8"
                                          IsVisible="{Binding IsVisibleToUser}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- AI 消息（左侧） -->
                                        <StackPanel Grid.Column="0"
                                                    IsVisible="{Binding !IsUser}"
                                                    HorizontalAlignment="Left"
                                                    Spacing="2">
                                            <!-- 消息头部：角色和时间 -->
                                            <StackPanel Orientation="Horizontal" Margin="4,0,0,2">
                                                <TextBlock Text="&gt; ASSISTANT"
                                                          FontSize="10"
                                                          Foreground="{DynamicResource DosSecondaryBrush}"
                                                          FontWeight="Bold"/>
                                                <TextBlock Text=" | "
                                                          FontSize="10"
                                                          Foreground="{DynamicResource DosSecondaryBrush}"
                                                          Margin="2,0"/>
                                                <TextBlock Text="{Binding TimestampText}"
                                                          FontSize="10"
                                                          Foreground="{DynamicResource DosSecondaryBrush}"/>
                                            </StackPanel>

                                            <!-- 消息气泡 -->
                                            <Border BorderBrush="{DynamicResource DosBorderBrush}"
                                                    BorderThickness="2"
                                                    Padding="10,6"
                                                    Background="{DynamicResource DosInputBackgroundBrush}"
                                                    CornerRadius="4">
                                                <Grid>
                                                    <!-- 左上角装饰 -->
                                                    <TextBlock Text="┌"
                                                              FontSize="14"
                                                              Foreground="{DynamicResource DosBorderBrush}"
                                                              HorizontalAlignment="Left"
                                                              VerticalAlignment="Top"
                                                              Margin="-12,-8,0,0"/>

                                                    <!-- 加载中动画 -->
                                                    <Panel Classes="loading-panel"
                                                          IsVisible="{Binding IsLoading}">
                                                        <TextBlock Text="." FontSize="13" Foreground="{DynamicResource DosSecondaryBrush}"/>
                                                        <TextBlock Text=".." FontSize="13" Foreground="{DynamicResource DosSecondaryBrush}"/>
                                                        <TextBlock Text="..." FontSize="13" Foreground="{DynamicResource DosSecondaryBrush}"/>
                                                        <TextBlock Text="...." FontSize="13" Foreground="{DynamicResource DosSecondaryBrush}"/>
                                                        <TextBlock Text="....." FontSize="13" Foreground="{DynamicResource DosSecondaryBrush}"/>
                                                        <TextBlock Text="......" FontSize="13" Foreground="{DynamicResource DosSecondaryBrush}"/>
                                                    </Panel>

                                                    <!-- 只读显示（非编辑且非加载中） -->
                                                    <Panel IsVisible="{Binding !IsLoading}">
                                                        <TextBlock Text="{Binding DisplayText}"
                                                                  TextWrapping="Wrap"
                                                                  FontSize="13"
                                                                  Foreground="{DynamicResource DosForegroundBrush}"
                                                                  IsVisible="{Binding !IsEditing}"/>
                                                    </Panel>

                                                    <!-- 编辑模式 -->
                                                    <TextBox Text="{Binding EditContent}"
                                                            TextWrapping="Wrap"
                                                            AcceptsReturn="True"
                                                            FontSize="13"
                                                            MinHeight="40"
                                                            MaxHeight="200"
                                                            IsVisible="{Binding IsEditing}"
                                                            BorderBrush="{DynamicResource DosHighlightBrush}"
                                                            BorderThickness="1"/>
                                                </Grid>
                                            </Border>

                                            <!-- 操作按钮（气泡外部底部）- 需要通过名称查找父级 -->
                                            <StackPanel Orientation="Horizontal"
                                                       Spacing="4"
                                                       Margin="4,2,0,0"
                                                       x:Name="AiActionButtons">
                                                <!-- 编辑按钮 -->
                                                <Button Padding="4,1"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).StartInlineEditCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding !IsEditing}"
                                                       ToolTip.Tip="编辑">
                                                    <TextBlock FontSize="9" Text="[ED]"/>
                                                </Button>
                                                <!-- 确认按钮 -->
                                                <Button Padding="4,1"
                                                       Foreground="{DynamicResource DosHighlightBrush}"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).ConfirmInlineEditCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding IsEditing}"
                                                       ToolTip.Tip="确认">
                                                    <TextBlock FontSize="9" Text="[OK]"/>
                                                </Button>
                                                <!-- 取消按钮 -->
                                                <Button Padding="4,1"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).CancelInlineEditCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding IsEditing}"
                                                       ToolTip.Tip="取消">
                                                    <TextBlock FontSize="9" Text="[X]"/>
                                                </Button>
                                                <!-- 重新生成按钮 -->
                                                <Button Padding="4,1"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).RegenerateResponseCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding !IsEditing}"
                                                       ToolTip.Tip="重新生成">
                                                    <TextBlock FontSize="9" Text="[RG]"/>
                                                </Button>
                                                <!-- 删除按钮 -->
                                                <Button Padding="4,1"
                                                       Foreground="{DynamicResource DosErrorBrush}"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).DeleteMessageCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding !IsEditing}"
                                                       ToolTip.Tip="删除">
                                                    <TextBlock FontSize="9" Text="[DL]"/>
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- 用户消息（右侧） -->
                                        <StackPanel Grid.Column="2"
                                                    IsVisible="{Binding IsUser}"
                                                    HorizontalAlignment="Right"
                                                    Spacing="2">
                                            <!-- 消息头部：时间和角色 -->
                                            <StackPanel Orientation="Horizontal"
                                                       HorizontalAlignment="Right"
                                                       Margin="0,0,4,2">
                                                <TextBlock Text="{Binding TimestampText}"
                                                          FontSize="10"
                                                          Foreground="{DynamicResource DosSecondaryBrush}"/>
                                                <TextBlock Text=" | "
                                                          FontSize="10"
                                                          Foreground="{DynamicResource DosSecondaryBrush}"
                                                          Margin="2,0"/>
                                                <TextBlock Text="USER &lt;"
                                                          FontSize="10"
                                                          Foreground="{DynamicResource DosSecondaryBrush}"
                                                          FontWeight="Bold"/>
                                            </StackPanel>

                                            <!-- 消息气泡 -->
                                            <Border BorderBrush="{DynamicResource DosHighlightBrush}"
                                                    BorderThickness="2"
                                                    Padding="10,6"
                                                    Background="{DynamicResource DosHoverBackgroundBrush}"
                                                    CornerRadius="4">
                                                <Grid>
                                                    <!-- 右上角装饰 -->
                                                    <TextBlock Text="┐"
                                                              FontSize="14"
                                                              Foreground="{DynamicResource DosHighlightBrush}"
                                                              HorizontalAlignment="Right"
                                                              VerticalAlignment="Top"
                                                              Margin="0,-8,-12,0"/>

                                                    <!-- 只读显示 -->
                                                    <TextBlock Text="{Binding DisplayText}"
                                                              TextWrapping="Wrap"
                                                              FontSize="13"
                                                              Foreground="{DynamicResource DosHighlightBrush}"
                                                              IsVisible="{Binding !IsEditing}"/>

                                                    <!-- 编辑模式 -->
                                                    <TextBox Text="{Binding EditContent}"
                                                            TextWrapping="Wrap"
                                                            AcceptsReturn="True"
                                                            FontSize="13"
                                                            MinHeight="40"
                                                            MaxHeight="200"
                                                            IsVisible="{Binding IsEditing}"
                                                            BorderBrush="{DynamicResource DosHighlightBrush}"
                                                            BorderThickness="1"
                                                            Foreground="{DynamicResource DosHighlightBrush}"/>
                                                </Grid>
                                            </Border>

                                            <!-- 操作按钮（气泡外部底部） -->
                                            <StackPanel Orientation="Horizontal"
                                                       Spacing="4"
                                                       HorizontalAlignment="Right"
                                                       Margin="0,2,4,0">
                                                <!-- 编辑按钮 -->
                                                <Button Padding="4,1"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).StartInlineEditCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding !IsEditing}"
                                                       ToolTip.Tip="编辑">
                                                    <TextBlock FontSize="9" Text="[ED]"/>
                                                </Button>
                                                <!-- 确认按钮 -->
                                                <Button Padding="4,1"
                                                       Foreground="{DynamicResource DosHighlightBrush}"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).ConfirmInlineEditCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding IsEditing}"
                                                       ToolTip.Tip="确认">
                                                    <TextBlock FontSize="9" Text="[OK]"/>
                                                </Button>
                                                <!-- 取消按钮 -->
                                                <Button Padding="4,1"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).CancelInlineEditCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding IsEditing}"
                                                       ToolTip.Tip="取消">
                                                    <TextBlock FontSize="9" Text="[X]"/>
                                                </Button>
                                                <!-- 删除按钮 -->
                                                <Button Padding="4,1"
                                                       Foreground="{DynamicResource DosErrorBrush}"
                                                       Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).DeleteMessageCommand}"
                                                       CommandParameter="{Binding}"
                                                       IsVisible="{Binding !IsEditing}"
                                                       ToolTip.Tip="删除">
                                                    <TextBlock FontSize="9" Text="[DL]"/>
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- 输入区域 -->
                    <Border Grid.Row="2"
                            BorderBrush="{DynamicResource DosBorderBrush}"
                            BorderThickness="0,2,0,0"
                            Padding="8"
                            Background="{DynamicResource DosBackgroundBrush}">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <!-- 附件按钮 -->
                            <Button Grid.Column="0"
                                    Content="[+]"
                                    FontSize="14"
                                    Command="{Binding AttachFileCommand}"
                                    ToolTip.Tip="添加附件"
                                    Margin="0,0,8,0"
                                    Padding="8,4"/>

                            <!-- 输入框 -->
                            <TextBox Grid.Column="1"
                                     Text="{Binding InputText}"
                                     Watermark="输入消息..."
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     MinHeight="36"
                                     MaxHeight="100"
                                     VerticalAlignment="Stretch"
                                     IsEnabled="{Binding !IsSending}"/>

                            <!-- 发送按钮 -->
                            <Button Grid.Column="2"
                                    Content="[SEND]"
                                    Command="{Binding SendMessageCommand}"
                                    IsEnabled="{Binding !IsSending}"
                                    Margin="8,0,0,0"
                                    Classes="primary"
                                    Padding="12,4"/>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- CONFIG Tab (index 1) -->
            <TabItem Header="CONFIG">
                <ScrollViewer>
                    <StackPanel Margin="8" Spacing="12">
                        <!-- 外观设置 -->
                        <Border BorderBrush="{DynamicResource DosBorderBrush}"
                               BorderThickness="2"
                               Padding="8">
                            <StackPanel Spacing="8">
                                <TextBlock Text="APPEARANCE"
                                          FontWeight="Bold"
                                          Foreground="{DynamicResource DosHighlightBrush}"/>

                                <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                              Text="Theme:"
                                              VerticalAlignment="Center"/>
                                    <ComboBox Grid.Row="0" Grid.Column="1"
                                             ItemsSource="{Binding Themes}"
                                             SelectedItem="{Binding Config.Theme}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                              Text="Font Size:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <NumericUpDown Grid.Row="1" Grid.Column="1"
                                                  Value="{Binding Config.FontSize}"
                                                  Minimum="10" Maximum="24"
                                                  Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                              Text="Show Heartbeat:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <CheckBox Grid.Row="2" Grid.Column="1"
                                             IsChecked="{Binding Config.ShowHeartbeatButton}"
                                             Margin="0,4,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- AI 模型设置 -->
                        <Border BorderBrush="{DynamicResource DosBorderBrush}"
                               BorderThickness="2"
                               Padding="8">
                            <StackPanel Spacing="8">
                                <TextBlock Text="AI MODEL"
                                          FontWeight="Bold"
                                          Foreground="{DynamicResource DosHighlightBrush}"/>

                                <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                              Text="Provider:"
                                              VerticalAlignment="Center"/>
                                    <ComboBox Grid.Row="0" Grid.Column="1"
                                             ItemsSource="{Binding Providers}"
                                             SelectedItem="{Binding Config.Provider}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                              Text="Base URL:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="1" Grid.Column="1"
                                            Text="{Binding Config.BaseUrl}"
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                              Text="API Key:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="2" Grid.Column="1"
                                            Text="{Binding Config.ApiKey}"
                                            PasswordChar="*"
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0"
                                              Text="Model:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="3" Grid.Column="1"
                                            Text="{Binding Config.Model}"
                                            Watermark="gpt-4o, gpt-3.5-turbo, etc."
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="4" Grid.Column="0"
                                              Text="Temperature:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <Grid Grid.Row="4" Grid.Column="1"
                                                Margin="0,4,0,0"
                                                ColumnDefinitions="*,30">
                                        <Slider Grid.Row="0" Value="{Binding Config.Temperature}"
                                               Minimum="0" Maximum="2"
                                               SmallChange="0.1" LargeChange="0.5"/>
                                        <TextBlock Grid.Column="1" Text="{Binding Config.Temperature, StringFormat={}{0:F1}}"
                                                  VerticalAlignment="Center"/>
                                    </Grid>

                                    <TextBlock Grid.Row="5" Grid.Column="0"
                                              Text="Max Tokens:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <NumericUpDown Grid.Row="5" Grid.Column="1"
                                                  Value="{Binding Config.MaxTokens}"
                                                  Minimum="100" Maximum="32000"
                                                  Increment="100"
                                                  Margin="0,4,0,0"/>

                                    <StackPanel Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2"
                                               Orientation="Horizontal"
                                               Spacing="8"
                                               Margin="0,8,0,0">
                                        <Button Content="[Test Connection]"
                                               Command="{Binding TestConnectionCommand}"
                                               IsEnabled="{Binding !IsTestingConnection}"
                                               Padding="8,4"/>
                                        <SelectableTextBlock Text="{Binding ConnectionStatus}"
                                                TextWrapping="Wrap"
                                                Width="400"
                                                VerticalAlignment="Center"
                                                FontSize="10"
                                                FontFamily="Consola"
                                                Foreground="{DynamicResource DosHighlightBrush}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- 次级模型设置（用于摘要生成等后台任务） -->
                        <Border BorderBrush="{DynamicResource DosBorderBrush}"
                               BorderThickness="2"
                               Padding="8">
                            <StackPanel Spacing="8">
                                <TextBlock Text="SECONDARY MODEL (Background Tasks)"
                                          FontWeight="Bold"
                                          Foreground="{DynamicResource DosHighlightBrush}"/>

                                <TextBlock Text="用于摘要生成等后台任务，可使用更便宜的模型"
                                          FontSize="11"
                                          Foreground="{DynamicResource DosSecondaryBrush}"/>

                                <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                              Text="Provider:"
                                              VerticalAlignment="Center"/>
                                    <ComboBox Grid.Row="0" Grid.Column="1"
                                             ItemsSource="{Binding Providers}"
                                             SelectedItem="{Binding Config.SecondaryProvider}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                              Text="Base URL:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="1" Grid.Column="1"
                                            Text="{Binding Config.SecondaryBaseUrl}"
                                            Watermark="留空则使用 AI Model 的 Base URL"
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                              Text="API Key:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="2" Grid.Column="1"
                                            Text="{Binding Config.SecondaryApiKey}"
                                            PasswordChar="*"
                                            Watermark="留空则使用 AI Model 的 API Key"
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0"
                                              Text="Model:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="3" Grid.Column="1"
                                            Text="{Binding Config.SecondaryModel}"
                                            Watermark="gpt-3.5-turbo, gpt-4o-mini, etc."
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="4" Grid.Column="0"
                                              Text="Temperature:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <Grid Grid.Row="4" Grid.Column="1"
                                                Margin="0,4,0,0"
                                                ColumnDefinitions="*,30">
                                        <Slider Value="{Binding Config.SecondaryTemperature}"
                                               Minimum="0" Maximum="2"
                                               SmallChange="0.1" LargeChange="0.5"/>
                                        <TextBlock Grid.Column="1" Text="{Binding Config.SecondaryTemperature, StringFormat={}{0:F1}}"
                                                  VerticalAlignment="Center"/>
                                    </Grid>

                                    <TextBlock Grid.Row="5" Grid.Column="0"
                                              Text="Max Tokens:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <NumericUpDown Grid.Row="5" Grid.Column="1"
                                                  Value="{Binding Config.SecondaryMaxTokens}"
                                                  Minimum="100" Maximum="4000"
                                                  Increment="100"
                                                  Margin="0,4,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Embedding 模型设置（用于向量检索） -->
                        <Border BorderBrush="{DynamicResource DosBorderBrush}"
                               BorderThickness="2"
                               Padding="8">
                            <StackPanel Spacing="8">
                                <TextBlock Text="EMBEDDING MODEL (Semantic Search)"
                                          FontWeight="Bold"
                                          Foreground="{DynamicResource DosHighlightBrush}"/>

                                <TextBlock Text="用于知识库语义检索，支持同义词和语义匹配"
                                          FontSize="11"
                                          Foreground="{DynamicResource DosSecondaryBrush}"/>

                                <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                              Text="Provider:"
                                              VerticalAlignment="Center"/>
                                    <ComboBox Grid.Row="0" Grid.Column="1"
                                             ItemsSource="{Binding Providers}"
                                             SelectedItem="{Binding Config.EmbeddingProvider}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                              Text="Base URL:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="1" Grid.Column="1"
                                            Text="{Binding Config.EmbeddingBaseUrl}"
                                            Watermark="留空则使用 AI Model 的 Base URL"
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                              Text="API Key:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="2" Grid.Column="1"
                                            Text="{Binding Config.EmbeddingApiKey}"
                                            PasswordChar="*"
                                            Watermark="留空则使用 AI Model 的 API Key"
                                            Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0"
                                              Text="Model:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <TextBox Grid.Row="3" Grid.Column="1"
                                            Text="{Binding Config.EmbeddingModel}"
                                            Watermark="text-embedding-3-small, text-embedding-ada-002"
                                            Margin="0,4,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- 记忆设置 -->
                        <Border BorderBrush="{DynamicResource DosBorderBrush}"
                               BorderThickness="2"
                               Padding="8">
                            <StackPanel Spacing="8">
                                <TextBlock Text="MEMORY"
                                          FontWeight="Bold"
                                          Foreground="{DynamicResource DosHighlightBrush}"/>

                                <!-- Tokens 使用量显示 -->
                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                       BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                       BorderThickness="1"
                                       CornerRadius="4"
                                       Padding="8,4"
                                       Margin="0,4,0,0">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0"
                                                  Text="{Binding ContextTokensInfo}"
                                                  VerticalAlignment="Center"
                                                  FontFamily="Consolas,Courier New,monospace"/>
                                        <TextBlock Grid.Column="1"
                                                  Text="[~80%]"
                                                  VerticalAlignment="Center"
                                                  Foreground="{DynamicResource SystemFillColorCautionBrush}"
                                                  FontSize="11"
                                                  Margin="8,0,0,0">
                                            <TextBlock.IsVisible>
                                                <Binding Path="IsNearCompressionThreshold"/>
                                            </TextBlock.IsVisible>
                                        </TextBlock>
                                    </Grid>
                                </Border>

                                <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                              Text="Max Context:"
                                              VerticalAlignment="Center"/>
                                    <NumericUpDown Grid.Row="0" Grid.Column="1"
                                                  Value="{Binding Config.MaxContextTokens}"
                                                  Minimum="1000" Maximum="128000"
                                                  Increment="1000"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                              Text="Compression:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <NumericUpDown Grid.Row="1" Grid.Column="1"
                                                  Value="{Binding Config.CompressionThreshold}"
                                                  Minimum="500" Maximum="128000"
                                                  Increment="500"
                                                  Margin="0,4,0,0"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                              Text="Auto Compress:"
                                              VerticalAlignment="Center"
                                              Margin="0,4,0,0"/>
                                    <CheckBox Grid.Row="2" Grid.Column="1"
                                             IsChecked="{Binding Config.AutoCompress}"
                                             Margin="0,4,0,0"/>
                                </Grid>

                                <!-- 压缩预览区域 -->
                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                       BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                       BorderThickness="1"
                                       CornerRadius="4"
                                       Padding="8"
                                       Margin="0,8,0,0">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Compression Preview:"
                                                  FontWeight="Bold"
                                                  FontSize="11"/>
                                        <TextBlock Text="{Binding CompressionPreview}"
                                                  TextWrapping="Wrap"
                                                  FontSize="11"
                                                  FontFamily="Consolas,Courier New,monospace"
                                                  MaxHeight="100"
                                                  Foreground="{DynamicResource TextControlPlaceholderForegroundBrush}"/>
                                    </StackPanel>
                                </Border>

                                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                                    <Button Content="[Compress]"
                                           Command="{Binding CompressContextCommand}"
                                           Padding="8,4"/>
                                    <Button Content="[Clear Context]"
                                           Command="{Binding ClearContextCommand}"
                                           Padding="8,4"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- TASKS Tab (index 2) -->
            <TabItem Header="TASKS">
                <Grid RowDefinitions="Auto,*" Margin="8">
                    <!-- 标题栏 -->
                    <StackPanel Grid.Row="0"
                               Orientation="Horizontal"
                               Spacing="8"
                               Margin="0,0,0,8">
                        <TextBlock Text="&gt; Tasks:"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                        <TextBlock Text="{Binding ScheduledTasks.Count}"
                                  Foreground="{DynamicResource DosHighlightBrush}"
                                  VerticalAlignment="Center"
                                  FontWeight="Bold"/>
                        <TextBlock Text="scheduled"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                        <Border Width="2" Height="20"
                               Background="{DynamicResource DosBorderBrush}"
                               Margin="8,0"/>
                        <Button Content="[+ New Task]"
                               Command="{Binding CreateTaskCommand}"
                               Padding="8,4"/>
                        <Button Content="[Clear All]"
                               Command="{Binding ClearAllTasksCommand}"
                               Padding="8,4"/>
                    </StackPanel>

                    <!-- 任务列表 -->
                    <Border Grid.Row="1"
                           BorderBrush="{DynamicResource DosBorderBrush}"
                           BorderThickness="2">
                        <ListBox ItemsSource="{Binding ScheduledTasks}"
                                Background="Transparent">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="{DynamicResource DosSecondaryBrush}"
                                           BorderThickness="0,0,0,1"
                                           Padding="8"
                                           Margin="0">
                                        <StackPanel Spacing="4">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="[TASK]"
                                                          FontWeight="Bold"
                                                          Foreground="{DynamicResource DosHighlightBrush}"/>
                                                <TextBlock Text="{Binding TriggerTimeDisplay}"
                                                          FontWeight="Bold"
                                                          Foreground="{DynamicResource DosForegroundBrush}"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding Intent}"
                                                      TextWrapping="Wrap"
                                                      Margin="0,4,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                                <TextBlock Text="Recurrence:"
                                                          Foreground="{DynamicResource DosSecondaryBrush}"
                                                          FontSize="11"/>
                                                <TextBlock Text="{Binding RecurrenceDisplay}"
                                                          FontSize="11"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                </Grid>
            </TabItem>

            <!-- HISTORY Tab (index 3) -->
            <TabItem Header="HISTORY">
                <views:HistoryTabView DataContext="{Binding HistoryTabViewModel}"/>
            </TabItem>

            <!-- MEMORY Tab (index 4) -->
            <TabItem Header="MEMORY">
                <Grid RowDefinitions="Auto,*,Auto,Auto" Margin="8">
                    <!-- 标题栏 -->
                    <StackPanel Grid.Row="0"
                               Orientation="Horizontal"
                               Spacing="8"
                               Margin="0,0,0,8">
                        <TextBlock Text="&gt; Knowledge Base"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                        <Button Content="[Refresh]"
                               Command="{Binding RefreshKnowledgeBaseCommand}"
                               Padding="8,2"
                               FontSize="12"/>
                    </StackPanel>

                    <!-- 知识库文件树和编辑区 -->
                    <Grid Grid.Row="1" ColumnDefinitions="*,*" Margin="0,0,0,8">
                        <!-- 文件树 -->
                        <Border BorderBrush="{DynamicResource DosBorderBrush}"
                               BorderThickness="2"
                               Margin="0,0,4,0">
                            <Grid RowDefinitions="*,Auto">
                                <TreeView Grid.Row="0"
                                         ItemsSource="{Binding KnowledgeFiles}"
                                         SelectedItem="{Binding SelectedKnowledgeFile}"
                                         Background="Transparent"
                                         Padding="4">
                                    <TreeView.ItemTemplate>
                                        <TreeDataTemplate ItemsSource="{Binding Children}">
                                            <TextBlock Text="{Binding Name}"/>
                                        </TreeDataTemplate>
                                    </TreeView.ItemTemplate>
                                    <TreeView.Styles>
                                        <Style Selector="TreeViewItem">
                                            <Setter Property="IsExpanded" Value="True"/>
                                        </Style>
                                    </TreeView.Styles>
                                    <TreeView.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="View" Command="{Binding ViewFileCommand}"/>
                                            <MenuItem Header="Delete" Command="{Binding DeleteFileCommand}"/>
                                        </ContextMenu>
                                    </TreeView.ContextMenu>
                                </TreeView>
                                <!-- 新建输入区 -->
                                <Grid Grid.Row="1" RowDefinitions="Auto,Auto" Margin="4">
                                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,4">
                                        <TextBox Text="{Binding NewFolderName}"
                                                Watermark="Folder name"
                                                Padding="4,2"/>
                                        <Button Grid.Column="1"
                                               Content="[+]"
                                               Command="{Binding NewFolderCommand}"
                                               Padding="4,2"
                                               Margin="4,0,0,0"/>
                                    </Grid>
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                        <TextBox Text="{Binding NewFileName}"
                                                Watermark="File name (.md)"
                                                Padding="4,2"/>
                                        <Button Grid.Column="1"
                                               Content="[+]"
                                               Command="{Binding NewFileCommand}"
                                               Padding="4,2"
                                               Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </Border>

                        <!-- 文件编辑区 -->
                        <Border Grid.Column="1"
                               BorderBrush="{DynamicResource DosBorderBrush}"
                               BorderThickness="2"
                               Margin="4,0,0,0">
                            <Grid RowDefinitions="Auto,*">
                                <TextBlock Grid.Row="0"
                                          Text="{Binding SelectedFileDisplayPath}"
                                          Padding="4"
                                          Foreground="{DynamicResource DosSecondaryBrush}"
                                          Background="{DynamicResource DosBorderBrush}"
                                          FontSize="11"/>
                                <TextBox Grid.Row="1"
                                        Text="{Binding EditingFileContent}"
                                        AcceptsReturn="True"
                                        TextWrapping="Wrap"
                                        IsReadOnly="{Binding !IsEditingFile}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="4"
                                        FontFamily="{DynamicResource MonospaceFontFamily}"
                                        Watermark="Select a file to view content..."/>
                            </Grid>
                        </Border>
                    </Grid>

                    <!-- 编辑操作按钮 -->
                    <StackPanel Grid.Row="2"
                               Orientation="Horizontal"
                               Spacing="8"
                               IsVisible="{Binding IsEditingFile}"
                               Margin="0,0,0,8">
                        <Button Content="[Save]"
                               Command="{Binding SaveFileCommand}"
                               Padding="8,4"/>
                        <Button Content="[Cancel]"
                               Command="{Binding CancelEditCommand}"
                               Padding="8,4"/>
                    </StackPanel>

                    <!-- 操作按钮 -->
                    <StackPanel Grid.Row="3"
                               Orientation="Horizontal"
                               Spacing="8">
                        <Button Content="[View]"
                               Command="{Binding ViewFileCommand}"
                               Padding="8,4"/>
                        <Button Content="[Import]"
                               Command="{Binding ImportCommand}"
                               Padding="8,4"/>
                        <Button Content="[Export]"
                               Command="{Binding ExportCommand}"
                               Padding="8,4"/>
                        <Button Content="[Delete]"
                               Command="{Binding DeleteFileCommand}"
                               Padding="8,4"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- LOGS Tab (index 5) -->
            <TabItem Header="LOGS">
                <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="8">
                    <!-- 筛选栏 - 日期范围和级别 -->
                    <Grid Grid.Row="0"
                         ColumnDefinitions="Auto,140,Auto,140,Auto,100,*"
                         Margin="0,0,0,8">
                        <TextBlock Grid.Column="0"
                                  Text="From:"
                                  VerticalAlignment="Center"
                                  Margin="0,0,4,0"/>
                        <CalendarDatePicker Grid.Column="1"
                                           SelectedDate="{Binding LogStartTime}"
                                           HorizontalAlignment="Stretch"/>
                        <TextBlock Grid.Column="2"
                                  Text="To:"
                                  VerticalAlignment="Center"
                                  Margin="8,0,4,0"/>
                        <CalendarDatePicker Grid.Column="3"
                                           SelectedDate="{Binding LogEndTime}"
                                           HorizontalAlignment="Stretch"/>
                        <TextBlock Grid.Column="4"
                                  Text="Level:"
                                  VerticalAlignment="Center"
                                  Margin="8,0,4,0"/>
                        <ComboBox Grid.Column="5"
                                 ItemsSource="{Binding LogLevels}"
                                 SelectedItem="{Binding SelectedLogLevel}"
                                 HorizontalAlignment="Stretch"/>
                    </Grid>

                    <!-- 操作栏 -->
                    <StackPanel Grid.Row="1"
                               Orientation="Horizontal"
                               Spacing="8"
                               Margin="0,0,0,8">
                        <TextBox Width="200"
                                Text="{Binding SearchLogText}"
                                Padding="8,4"/>
                        <Button Content="[Search]"
                               Command="{Binding SearchLogsCommand}"
                               Padding="8,4"/>
                        <Button Content="[Refresh]"
                               Command="{Binding RefreshLogsCommand}"
                               Padding="8,4"/>
                        <Button Content="[Clear]"
                               Command="{Binding ClearLogsCommand}"
                               Padding="8,4"/>
                        <Button Content="[Export]"
                               Command="{Binding ExportLogsCommand}"
                               Padding="8,4"/>
                    </StackPanel>

                    <!-- 日志列表 -->
                    <Border Grid.Row="2"
                           BorderBrush="{DynamicResource DosBorderBrush}"
                           BorderThickness="2"
                           Margin="0,0,0,8">
                        <ListBox ItemsSource="{Binding LogEntries}"
                                Background="Transparent">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="{DynamicResource DosSecondaryBrush}"
                                           BorderThickness="0,0,0,1"
                                           Padding="6,4">
                                        <Grid ColumnDefinitions="130,60,*">
                                            <TextBlock Grid.Column="0"
                                                      Text="{Binding Timestamp, StringFormat=[{0:MM-dd HH:mm:ss}]}"
                                                      Foreground="{DynamicResource DosSecondaryBrush}"
                                                      FontFamily="{StaticResource MonospaceFontFamily}"
                                                      FontSize="11"/>
                                            <TextBlock Grid.Column="1"
                                                      Text="{Binding Level}"
                                                      Foreground="{Binding LevelColor}"
                                                      FontFamily="{StaticResource MonospaceFontFamily}"
                                                      FontSize="11"
                                                      FontWeight="Bold"
                                                      Margin="4,0"/>
                                            <TextBlock Grid.Column="2"
                                                      Text="{Binding Message}"
                                                      TextWrapping="Wrap"
                                                      FontFamily="{StaticResource MonospaceFontFamily}"
                                                      FontSize="11"
                                                      MaxLines="2"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>

                    <!-- 分页控制栏 -->
                    <StackPanel Grid.Row="3"
                               Orientation="Horizontal"
                               Spacing="8">
                        <Button Content="&lt;"
                               Command="{Binding PrevPageCommand}"
                               IsEnabled="{Binding HasPrevPage}"
                               Padding="8,4"
                               MinWidth="32"/>
                        <TextBlock Text="{Binding CurrentPageInfo}"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosHighlightBrush}"
                                  FontWeight="Bold"
                                  MinWidth="80"
                                  TextAlignment="Center"/>
                        <Button Content="&gt;"
                               Command="{Binding NextPageCommand}"
                               IsEnabled="{Binding HasNextPage}"
                               Padding="8,4"
                               MinWidth="32"/>
                        <Border Width="2" Height="20"
                               Background="{DynamicResource DosBorderBrush}"
                               Margin="8,0"/>
                        <TextBlock Text="Per Page:"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                        <ComboBox ItemsSource="{Binding LogPageSizes}"
                                 SelectedItem="{Binding SelectedLogPageSize}"
                                 MinWidth="60"/>
                    </StackPanel>
                    <!--日志总数-->
                    <StackPanel Grid.Row="3"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <TextBlock Text="Total:"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                        <TextBlock Text="{Binding TotalLogCount}"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosHighlightBrush}"
                                  FontWeight="Bold"/>
                        <TextBlock Text="entries"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- ABOUT Tab (index 6) -->
            <TabItem Header="ABOUT">
                <StackPanel Margin="40,20" Spacing="16" HorizontalAlignment="Center">
                    <!-- ASCII Art Logo -->
                    <Border BorderBrush="{DynamicResource DosBorderBrush}"
                           BorderThickness="2"
                           Padding="20,12">
                        <StackPanel Spacing="8">
                            <TextBlock Text="  ATHENA"
                                      FontFamily="{StaticResource MonospaceFontFamily}"
                                      FontSize="28"
                                      FontWeight="Bold"
                                      HorizontalAlignment="Center"
                                      Foreground="{DynamicResource DosHighlightBrush}"/>
                            <TextBlock Text="AI Companion Assistant"
                                      FontSize="14"
                                      HorizontalAlignment="Center"
                                      Foreground="{DynamicResource DosForegroundBrush}"/>
                        </StackPanel>
                    </Border>

                    <StackPanel Spacing="8">
                        <TextBlock Text="Version 1.0.0"
                                  FontSize="12"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>

                        <TextBlock Text="&quot;Wisdom begins in wonder&quot;"
                                  FontStyle="Italic"
                                  FontSize="12"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                    </StackPanel>

                    <Border Height="1"
                           Background="{DynamicResource DosBorderBrush}"
                           Margin="0,8"/>

                    <StackPanel Spacing="6">
                        <TextBlock Text="Based on .NET &amp; Avalonia UI"
                                  FontSize="11"
                                  HorizontalAlignment="Center"/>

                        <TextBlock Text="2024 - Licensed under MIT"
                                  FontSize="11"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource DosSecondaryBrush}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal"
                               Spacing="8"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0">
                        <Button Content="[Updates]"
                               Command="{Binding CheckForUpdatesCommand}"
                               Padding="12,6"/>
                        <Button Content="[Docs]"
                               Command="{Binding OpenDocumentationCommand}"
                               Padding="12,6"/>
                        <Button Content="[GitHub]"
                               Command="{Binding OpenGitHubCommand}"
                               Padding="12,6"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- 底部按钮栏 - 仅在CONFIG页(index 1)显示 -->
        <Border Grid.Row="1"
               BorderBrush="{DynamicResource DosBorderBrush}"
               BorderThickness="0,2,0,0"
               Padding="8"
               Background="{DynamicResource DosBackgroundBrush}"
               IsVisible="{Binding IsShowConfigSaveReset}">
            <StackPanel Orientation="Horizontal"
                       HorizontalAlignment="Right"
                       Spacing="8">
                <Button Content="[Save]"
                       Command="{Binding SaveConfigCommand}"
                       Classes="primary"
                       Padding="12,4"/>
                <Button Content="[Reset]"
                       Command="{Binding ResetConfigCommand}"
                       Padding="12,4"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
